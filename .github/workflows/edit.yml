name: Validate & Auto-Format JSON

on:
  push:
    paths:
      - 'app/apps.json'  # Watches the file inside the /app folder
  workflow_dispatch:

permissions:
  contents: write

jobs:
  validate-and-format:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate JSON
        run: |
          # Check if JSON syntax is valid
          jq empty app/apps.json && echo "✅ JSON is valid"

      - name: Sort & Format
        run: |
          # Sort apps by ID and format prettily
          jq '.apps |= sort_by(.id)' app/apps.json > temp.json
          mv temp.json app/apps.json
          echo "✅ JSON sorted by ID"

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add app/apps.json
          
          # Only commit if there are actual changes
          git diff --quiet && git diff --staged --quiet || git commit -m "chore: auto-sort and format apps.json"
          
          git push